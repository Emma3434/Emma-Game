<!DOCTYPE html>
<html>

<head>
    <% include ../partials/header.ejs %>
</head>

<body>
    <div>
        <% include ../partials/nav-sign.ejs %>
    </div>
    <h1 class="discussion-heading">Welcome Back!</h1>
    <div style="margin-top: 20px;">
        <div class="form-group signin-group"><label class="signin-label">username</label><input class="border rounded border-primary shadow-sm signin-input" type="text" id="username" placeholder="username"></div>
        <div class="form-group signin-group"><label class="signin-label">password</label><input class="border rounded border-primary shadow-sm signin-input" type="password" id="password" placeholder="password"></div>
        <div class="form-group d-sm-flex d-md-flex d-lg-flex d-xl-flex signin-group"><button class="btn btn-primary" type="button" onclick="signin()">Sign in</button></div>
        <script>
            function signin() {
                var username = document.getElementById("username").value;
                var password = document.getElementById("password").value;

                var myHeaders = new Headers();
                myHeaders.append("Content-Type", "application/json");

                var raw = JSON.stringify({"username":username,"password":password});

                var requestOptions = {
                    method: 'POST',
                    headers: myHeaders,
                    body: raw,
                    redirect: 'follow'
                };

                fetch("https://emma-game-server.herokuapp.com/signin", requestOptions)
                    .then(response => response.json())
                    .then(result => {
                        console.log(result);
                        if (result.success){
                            alert("Signed in as " + result.username);
                            document.getElementById("user").innerHTML=username;
                            //token = JSON.stringify(result.token);
                            //username = JSON.stringify(result.username);
                            //localStorage.setItem("token", result.token);
                            //console.log(localStorage.getItem("token"));
                            //console.log(token);
                            //window.location.href = "dashboard";
                            return result.redirect('/dashboard');
                        }
                        else{
                            alert(result.message);
                        }
                    })
                    .catch(error => console.log('error', error));
            }
        </script>
    </div>
</body>

</html>